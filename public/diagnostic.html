<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrustedLogos Diagnostic</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .status { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .warning { background: #fff3cd; color: #856404; }
        .log { background: #f8f9fa; padding: 10px; margin: 5px 0; font-family: monospace; font-size: 12px; border-left: 3px solid #007bff; }
    </style>
</head>
<body>
    <h1>üîç TrustedLogos Diagnostic</h1>
    
    <div id="status-container"></div>
    
    <div class="status info">
        <h3>Console Output:</h3>
        <div id="console-output"></div>
    </div>

    <script>
        const statusContainer = document.getElementById('status-container');
        const consoleOutput = document.getElementById('console-output');
        
        function addStatus(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = message;
            statusContainer.appendChild(div);
        }
        
        function addLog(message) {
            const div = document.createElement('div');
            div.className = 'log';
            div.textContent = new Date().toLocaleTimeString() + ': ' + message;
            consoleOutput.appendChild(div);
        }
        
        // Capture console messages
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        console.log = function(...args) {
            addLog('LOG: ' + args.join(' '));
            originalLog.apply(console, arguments);
        };
        
        console.error = function(...args) {
            addLog('ERROR: ' + args.join(' '));
            originalError.apply(console, arguments);
        };
        
        console.warn = function(...args) {
            addLog('WARN: ' + args.join(' '));
            originalWarn.apply(console, arguments);
        };
        
        addStatus('‚úÖ Diagnostic page loaded', 'success');
        addLog('Starting diagnostic tests...');
        
        // Test 1: Environment variables
        addStatus('üîç Testing environment variables...', 'info');
        
        // Test 2: Try loading main React app modules
        setTimeout(async () => {
            try {
                addLog('Testing Supabase client...');
                const supabaseModule = await import('/src/lib/supabase.ts');
                addStatus('‚úÖ Supabase client loaded successfully', 'success');
                addLog('Supabase client: ' + (supabaseModule.supabase ? 'OK' : 'MISSING'));
                
                // Test industry categories
                addLog('Testing industry categories...');
                const categoriesModule = await import('/src/utils/industryCategories.ts');
                addStatus(`‚úÖ Industry categories loaded (${categoriesModule.INDUSTRY_CATEGORIES.length} categories)`, 'success');
                
                // Test logo hooks
                addLog('Testing logo hooks...');
                const logoHooksModule = await import('/src/hooks/useLogos.tsx');
                addStatus('‚úÖ Logo hooks loaded successfully', 'success');
                
                // Test main app
                addLog('Testing main App component...');
                const appModule = await import('/src/App.tsx');
                addStatus('‚úÖ App component loaded successfully', 'success');
                
                // Try to render React
                addLog('Testing React rendering...');
                const reactModule = await import('react');
                const reactDomModule = await import('react-dom/client');
                
                // Create a test React component
                const TestComponent = reactModule.createElement('div', {
                    style: { padding: '20px', background: '#e8f5e8', borderRadius: '4px', margin: '10px 0' }
                }, 'React is rendering successfully! üéâ');
                
                // Try to render it
                const testContainer = document.createElement('div');
                testContainer.id = 'react-test';
                document.body.appendChild(testContainer);
                
                const root = reactDomModule.createRoot(testContainer);
                root.render(TestComponent);
                
                addStatus('‚úÖ React rendering test passed!', 'success');
                addStatus('üéØ All tests passed! The issue might be specific to your browser or a race condition.', 'warning');
                
                addStatus(`
                    <strong>Try these solutions:</strong><br>
                    1. Hard refresh (Ctrl+F5 or Cmd+Shift+R)<br>
                    2. Clear browser cache and cookies<br>
                    3. Try in incognito/private mode<br>
                    4. Try a different browser<br>
                    5. Check browser console (F12) for specific errors<br>
                    <br>
                    <strong>Main app URL:</strong> <a href="http://127.0.0.1:5175/" target="_blank">http://127.0.0.1:5175/</a>
                `, 'info');
                
            } catch (error) {
                addStatus(`‚ùå Module loading failed: ${error.message}`, 'error');
                addLog('Error details: ' + error.stack);
                
                // Try to identify the specific issue
                if (error.message.includes('supabase')) {
                    addStatus('üîß Issue seems related to Supabase configuration', 'warning');
                } else if (error.message.includes('industry')) {
                    addStatus('üîß Issue seems related to industry categories', 'warning');
                } else {
                    addStatus('üîß General module loading issue detected', 'warning');
                }
            }
        }, 1000);
        
        // Test network connectivity to Supabase
        setTimeout(() => {
            addLog('Testing Supabase connectivity...');
            fetch('https://amgzjhmaggmzvzcuhckq.supabase.co/rest/v1/', {
                headers: {
                    'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFtZ3pqaG1hZ2dtenZ6Y3VoY2txIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUzNTkwNzUsImV4cCI6MjA3MDkzNTA3NX0.VvoaIRN9Br2fQLsNQTj_UylQ8bLMNXsH92xoDrmGOwA'
                }
            })
            .then(response => {
                if (response.ok) {
                    addStatus('‚úÖ Supabase connectivity test passed', 'success');
                    addLog('Supabase API is reachable');
                } else {
                    addStatus(`‚ö†Ô∏è Supabase responded with status: ${response.status}`, 'warning');
                }
            })
            .catch(error => {
                addStatus('‚ùå Supabase connectivity test failed: ' + error.message, 'error');
                addLog('Supabase connection error: ' + error.message);
            });
        }, 2000);
        
    </script>
</body>
</html>